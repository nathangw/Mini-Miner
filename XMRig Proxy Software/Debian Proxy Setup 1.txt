

********************  COMMON COMMANDS  ********************

Proxy Log View:    sudo tail -f /var/log/xmrig-proxy.log

Proxy Log 200:   sudo tail -n 200 /var/log/xmrig-proxy.log



Access Log View:    sudo tail -f /var/log/xmrig-proxy-access.log


Key commands to switch between TTY screens (FOR MINERS WITH A DISPLAY)
   Ctrl + Alt + F1 → tty1 (normal login console)
   Ctrl + Alt + F2 → tty2 (XMRig display)




********************  DISABLE SECURE BOOT IN BIOS  ********************



1) Reboot the KAMRUI Pinova P2.
2) As soon as it starts booting, repeatedly press **DEL** (or **F2** on some units) to enter the BIOS/UEFI setup.
3) In BIOS, go to the **Boot** or **Security** tab (depends on BIOS version).
4) Find **Secure Boot** and set it to **Disabled**.
5) If there is an option called **OS Type**, set it to **Other OS** (if available).
6) Press **F10** to Save & Exit, then confirm.









********************  CREATE A DEBIAN BOOT USB STICK  ********************

Windows Instructions:

Download Debian ISO:   https://www.debian.org/download
    choose the 64-bit netinst ISO.
Download Rufus:  https://rufus.ie
Insert a USB drive (8 GB or larger).
Open Rufus and set:
    Device: your USB drive
    Boot selection: Choose the Debian ISO you downloaded
    Partition scheme: GPT (for UEFI) or MBR (for legacy BIOS)
Leave all other options at defaults.
Click Start, confirm it will erase the USB, and wait for it to finish.












********************  INSTALL DEBIAN FROM USB  ********************

Boot with USB
You may have to choose to boot from USB first in BIOS if you already have an operating system installed.
DO NOT choose Graphical Install.   Choose plain "Install"
Wireless network type:   WPA/WPA2 PSK
Hostname:    Miner(number)  no space
Domain name:    leave blank
Root password:    YourPassword
Full name for the new user:   YourFirstName
Username for your account:    yourfirstname  (lower case)
Choose a password for the new user:    YourPassword
Force UEFI installation?   Yes
Partition method:   Guided - use entire disk
Partition scheme:   All files in one partition (recommended for new users)

Choose software to install:
	uncheck Debian desktop environment
	uncheck GNOME
	✅ SSH Server
	✅ Standard System Utilities















********************  UPDATE THE MOTHERBOARD BIOS  ********************


1) Go to the KAMRUI support page for the Pinova P2:
   https://kamrui.com/pages/support
   (Search for: Pinova P2)

2) Download the latest BIOS update package for the Pinova P2.

3) Extract the ZIP file on a Windows PC.

4) Copy all extracted files onto a USB flash drive formatted as FAT32.

5) Plug the USB drive into the Pinova P2.

6) Reboot the Pinova P2 and repeatedly press **DEL or F2** to enter BIOS.

7) In BIOS, open the **EZ Flash / M-Flash / Instant Flash** tool 
   (the menu name may vary slightly).

8) Choose the BIOS file on the USB drive and confirm the update.

9) Wait for the update to complete.
   The system will reboot automatically.

10) After reboot, enter BIOS again and verify:
    • Secure Boot = Disabled
    • Boot Mode = UEFI

11) Press F10 to Save & Exit.

Your BIOS is now updated.






















********************  GET REMOTE CONSOLE WORKING  ********************

Command:   su -
Command:   apt update
Command:   apt install sudo openssh-server -y
Command:   systemctl enable --now ssh
Command:   usermod -aG sudo YOUR_USER_NAME       #Put your username in the command
Command:   reboot

   Get the assigned IP address for this machine from your router.

From Windows Powershell:    ssh nathan@192.168.1.22   (check for the ip address on your router, use your username)





From now on, it is much easier to finish the install from a desktop PC where you can cut and paste the rest of the commands.

















********************  SET STATIC IP  ********************

Show all the connected network adapters:   ip link

CHANGE wlx9ce INTERFACE NAME, IP ADDRESS AND YOUR WIFI CREDENTIALS BELOW
AND COPY AND PASTE INTO nano


Command:   sudo nano /etc/network/interfaces
#########################################################
GET THE TEXT FROM DEBIAN PROXY PERSONAL
GET THE TEXT FROM DEBIAN PROXY PERSONAL
GET THE TEXT FROM DEBIAN PROXY PERSONAL
#########################################################
Ctrl-O,  Enter,  Ctrl-X

Command:   sudo apt install -y avahi-daemon
Command:   sudo systemctl enable avahi-daemon
Command:   sudo systemctl restart avahi-daemon

Command:   sudo reboot


From Windows Powershell:    ssh nathan@192.168.1.33   (check for the ip address on the router)

Check the current IP address:   ip a

Go to the Network Router:
	Basic / Attached Devices.   Check, click edit and Rename from Panda Wireless to Miner(number).



If you get security problems, generate a new SSH key:   ssh-keygen -R 192.168.1.37    #use your IP address.











********************  VERIFY DNS WORK  ********************

Command:   ping google.com



Unlock the File:    sudo chattr -i /etc/resolv.conf

Command:    sudo nano /etc/resolv.conf
#########################################################
nameserver 1.1.1.1
nameserver 8.8.8.8
#########################################################
Ctrl-O,  Enter,  Ctrl-X

Lock the File:    sudo chattr +i /etc/resolv.conf

Command:   ping google.com












********************  UPDATE THE VIDEO DRIVER  ********************

Command:

sudo apt install -y \
  firmware-linux \
  firmware-linux-nonfree \
  firmware-amd-graphics

Reboot to apply updates:

Command:   sudo reboot






(REMOVE)  DID NOT USE
(REMOVE)  DID NOT USE
(REMOVE)  DID NOT USE

********************  KEEP DISPLAY ON   ********************

The KAMRUI Pinova P2 uses AMD integrated graphics.
No special configuration is required to keep the display active.

If you want to prevent the screen from blanking on the local console:

Command:   sudo nano /etc/default/console-setup

Add or confirm these lines:

  BLANK_TIME=0
  POWERDOWN_TIME=0

Save and exit:
Ctrl-O  Enter  Ctrl-X

Then reboot:

Command:   sudo reboot

This disables automatic console blanking so the display stays on.



(REMOVE)  DID NOT USE
(REMOVE)  DID NOT USE
(REMOVE)  DID NOT USE













********************  SETUP XMRIG-PROXY CONFIG DATA   ********************

Then copy everything into the nano editor below except the ##### bars on the top and bottom.

Command:  sudo nano /etc/proxy.env
#########################################################
GET THE TEXT FROM DEBIAN PROXY PERSONAL
GET THE TEXT FROM DEBIAN PROXY PERSONAL
GET THE TEXT FROM DEBIAN PROXY PERSONAL
#########################################################
Ctrl-O, Enter, Ctrl-X

Command:   sudo chmod 644 /etc/proxy.env



















********************  SETUP SMTP EMAIL ACCOUNT  ********************

You can use any SMTP Account you want.   email notifications are free.

Example:  Get Gmail SMTP Password.
  1) Go to myaccount.google.com/security
  2) Enable 2-Step Verification under Signing in to Google.
  3) After it’s enabled, click App passwords.
  4) Choose Mail → Other (Custom name) → type miner-email → Generate.
  5) Copy the 16-character password (no spaces).
  6) Use it in /etc/msmtprc as your Gmail SMTP password.


Command:   sudo apt install -y msmtp msmtp-mta mailutils

Command:   sudo nano /etc/msmtprc
#########################################################
GET THE TEXT FROM DEBIAN PERSONAL
GET THE TEXT FROM DEBIAN PERSONAL
GET THE TEXT FROM DEBIAN PERSONAL
#########################################################
Ctrl-O, Enter, Ctrl-X

Command:   sudo chmod 644 /etc/msmtprc


Command:   sudo nano /usr/local/bin/send_email.sh
#########################################################
#!/bin/bash
# =====================================
# send_email(subject, body)
# Reusable function to send emails via msmtp
# =====================================

# --- CONFIGURATION ---
[ -f /etc/proxy.env ] && . /etc/proxy.env                     # Load /etc/proxy.env if it exists
: "${EMAIL_TO:?ERROR: EMAIL_TO not set in /etc/proxy.env}"    # Require EMAIL_TO or exit with error

HOSTNAME_STR=$(hostname)

send_email() {
  local subject="$1"
  local body="$2"
  local ts
  ts=$(date '+%Y-%m-%d %H:%M:%S')

  # Sanitize subject
  subject=$(printf "%s" "$subject" | tr -d '\r\n')

  # Append clean signature ONCE
  body="${body}\n\n---\nAutomated notification from ${HOSTNAME_STR}"

  # Check for internet connectivity (max wait 30 seconds)
  local attempt=0
  while ! ping -c1 -W2 8.8.8.8 >/dev/null 2>&1; do
    attempt=$((attempt + 1))
    if [ "$attempt" -ge 6 ]; then
      echo "[$ts] No internet connection after 30 seconds — skipping email: $subject"
      return 1
    fi
    echo "[$ts] No connection yet — retrying in 5 seconds..."
    sleep 5
  done
  printf "[$ts] Sending email..."

  # Send email via msmtp (HTML with readable monospace formatting)
  if command -v msmtp >/dev/null 2>&1; then

    # Escape HTML-sensitive characters
    esc_body="$(printf "%b" "$body" \
      | sed 's/&/\&amp;/g; s/</\&lt;/g; s/>/\&gt;/g')"

    cat <<EOF | msmtp -t
To: $EMAIL_TO
From: $EMAIL_TO
Subject: $subject
MIME-Version: 1.0
Content-Type: text/html; charset=UTF-8

<html>
  <body style="font-family: Arial, Helvetica, sans-serif; font-size: 14px; color: #000;">
    <pre style="
      font-family: 'Courier New', Consolas, monospace;
      font-size: 14px;
      line-height: 1.35;
      color: #000000;
      padding: 12px;
      border-radius: 6px;
      white-space: pre-wrap;
    ">
$esc_body
    </pre>
  </body>
</html>
EOF

    echo "Email sent: $subject"
  else
    echo "NOTICE: msmtp not found; skipping email: $subject"
  fi
}
#########################################################
Ctrl-O, Enter, Ctrl-X



Command:   sudo chmod +x /usr/local/bin/send_email.sh

Test the email:   bash -c "source /usr/local/bin/send_email.sh; send_email 'Test email from $(hostname)' 'This is a test of the reusable send_email() function. If you see this, msmtp is working correctly.'"









********************  INSTALL XMRIG-PROXY   ********************

Command:   sudo apt update && sudo apt upgrade -y
Command:   sudo apt install -y git build-essential cmake automake libtool autoconf
Command:   sudo apt install -y build-essential cmake git pkg-config libhwloc-dev libuv1-dev libssl-dev
Command:   sudo apt install -y jq

Clone and Build XMRig Proxy:

Command:   sudo -i
Command:   cd /root
Command:   git clone https://github.com/xmrig/xmrig-proxy.git
Command:   cd xmrig-proxy
Command:   mkdir build && cd build
Command:   cmake ..
Command:   make -j$(nproc)



Command:   sudo nano /etc/systemd/system/xmrig-proxy.service
#########################################################
[Unit]
Description=XMRig Proxy
After=network-online.target
Wants=network-online.target

[Service]
User=root
WorkingDirectory=/root/xmrig-proxy/build

# load /etc/proxy.env
EnvironmentFile=/etc/proxy.env

# run proxy command defined in env
ExecStart=/bin/bash -c 'eval "$XMRIG_PROXY_CMD"'

Restart=always
RestartSec=30

Nice=5
LimitNOFILE=65535

StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
#########################################################
Ctrl-O Enter Ctrl-X



Command:   sudo systemctl daemon-reload
Command:   sudo systemctl enable --now xmrig-proxy.service










******************** SHOW XMRIG-PROXY OUTPUT SCREEN AT BOOT ********************

FOR MINERS WITH DISPLAY ONLY
FOR MINERS WITH DISPLAY ONLY
FOR MINERS WITH DISPLAY ONLY

Note:  XMRig-Proxy will display on TTY2

Command:   sudo apt update && sudo apt upgrade -y
Command:   sudo apt install -y ccze


Command:   sudo nano /usr/local/bin/xmrig-proxy-display.sh
#########################################################
#!/bin/bash

# Hard-bind this process to tty2 to prevent console races
exec </dev/tty2 >/dev/tty2 2>&1

clear
echo -e "\e[1;33m=== XMRig-Proxy Live Log (tty2) ===\e[0m"
echo -e "\e[2;37mCtrl-Alt-F1: login • tty2 auto-shown on boot\e[0m"
sleep 1

exec journalctl -u xmrig-proxy -f -o cat --no-pager | ccze -A
#########################################################
Ctrl-O, Enter, Ctrl-X



Command:   sudo chmod +x /usr/local/bin/xmrig-proxy-display.sh
       


Command:   sudo nano /etc/systemd/system/xmrig-proxy-display.service
#########################################################
[Unit]
Description=Rainbow XMRig-Proxy log on console (tty2)

# Start only after xmrig-proxy is running
After=xmrig-proxy.service
Wants=xmrig-proxy.service

# Take ownership of tty2 cleanly
Conflicts=getty@tty2.service
After=getty@tty2.service

[Service]
Type=simple

# Switch to tty2 before starting
ExecStartPre=/usr/bin/chvt 2

# Run your display script
ExecStart=/usr/local/bin/xmrig-proxy-display.sh

# Explicitly bind to tty2
TTYPath=/dev/tty2
StandardInput=tty
StandardOutput=tty

# Reset terminal state cleanly
TTYReset=yes
TTYVHangup=yes

# Restart if something crashes
Restart=always
RestartSec=2

# Prevent rapid restart loops
StartLimitIntervalSec=300
StartLimitBurst=3

KillMode=control-group

[Install]
WantedBy=multi-user.target
#########################################################
Ctrl-O, Enter, Ctrl-X

MUST RUN THIS EVERY TIME:   sudo systemctl daemon-reload


Command:   sudo systemctl enable xmrig-proxy-display.service
Command:   sudo systemctl set-default multi-user.target

Command:   sudo reboot






******************** MATCH THE SCREEN RESOLUTION ********************

Monitor is:   7 inch Portable Monitor Touchscreen IPS 1080P 1920 x 1080 60Hz Mini LCD Display Model R070F02T   Amazon $70

THE SYSTEM RESOLUTION SETTING MUST MATCH THE MONITOR EXACTLY TO DISPLAY XMRIG

Command:   sudo nano /etc/default/grub

Find the line:   GRUB_CMDLINE_LINUX_DEFAULT="quiet"

Change it to exactly:   GRUB_CMDLINE_LINUX_DEFAULT="quiet video=1920x1080@60"

Ctrl-O, Enter, Ctrl-X


MUST RUN THIS EVERY TIME:   sudo update-grub

Command:   sudo reboot







******************** MAKE THE LOCAL DISPLAY FONT BIGGER ********************

FOR MINERS WITH DISPLAY ONLY
FOR MINERS WITH DISPLAY ONLY
FOR MINERS WITH DISPLAY ONLY

Command:   sudo nano /etc/default/console-setup

Change:    FONTFACE="Fixed"
           FONTSIZE="16x32"

Ctrl-O  Enter  Ctrl-X

Command:   sudo setupcon
Command:   sudo update-initramfs -u

Command:   sudo reboot









